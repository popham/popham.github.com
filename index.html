<html>
  <head>
    <title>Tim Popham's Github Projects</title>
  </head>
  <body>
    <p>Welcome to my (embarassingly) new Github <a 
href="http://github.com/popham/">projects 
page</a>. For now there's only the one project.</p>
    
    <p><a href="/chatterbox/">Chatterbox</a> is a toy project intended to test the feasibility of WebSockets across mobile platforms (Android and iPhone) and modern browsers, with a server built in Ruby. I expect the project to look decent before March of 2012. If all goes well, my new wisdom will get folded into a commercial project. As the code gets integrated into a larger ecosystem, I expect namespacing revisions to propagate into this codebase to facilitate such integration for others and myself in the future. Any architectural changes, however, will probably remain in a private fork.</p>
    <p><em>Update:</em> I've been dissapointed by the fragility of Ruby's Goliath webserver. I'm sure that I would eat those words with properly aligned versions of the MongoDB drivers, but with a single process the server's stability is especially important, so I've put the Ruby implementation on hold until the codebase goes inert for a while. As an alternative, I've <a href="http://github.com/popham/chatterbox-warp/">begun implementing</a> for the <a href="http://github.com/yesodweb/wai">Warp</a> server built on top of Haskell. I'm still bending my mind around functional programming, but I've been impressed thus far with the language's community. I only hope the server itself proves as impressive.</p>
    <p>I'm moving project documentation here until competing projects require better organization. Most would put protocol documents under the server, I realize. Maybe once client development begins such an organization may emerge.</p>
  <h1>Chatterbox</h1>
  <p>Chatterbox is a N-person messaging application distributed across iOS, Android, and desktop browsers. The project explores <a href="http://tools.ietf.org/html/draft-ietf-hybi-thewebsocketprotocol-17">WebSockets protocol</a> feasiblity, with an eye toward generalization. The protocol has been chosen for its low power consumption on mobile platforms and for its ability to generalize to much broader uses within an application framework.</p>
  <p><strike>I feel that the Rails framework provides just enough structure on top of the Ruby programming language for implementing web services. The <a href="https://github.com/igrigorik/em-websocket">EM-WebSocket</a> gem has been chosen for Chatterbox's server.</strike> Under Haskell, the Warp server's stack looks designed from top to bottom for asynchronicity, hopefully yielding a stable, performant server.</p>
  <p>Apache 2.0 licensed client libraries exist for both Android and iPhone. On the iPhone platform, the unitt project's <a href="http://code.google.com/p/unitt/wiki/UnittWebSocketClient">UnittWebSocketClient</a> has been chosen because it adopts iOS design idioms and there exist no other viable alternatives. On the Android platform, <a href="http://www.tavendo.de/autobahn/doc/android/index.html">Autobahn WebSockets for Android</a> has been chosen because it adopts Android design idioms and it appears more active and professionally maintained than any of its alternatives.</p>

  <div id="chatterbox-conversant-permissions">
    <h2>Conversant Permissions</h2>
    <p>Every conversant has a default permission that governs how conversations begin with all other conversants. Additionally, any conversant can override the default permission for any specific conversant. So for any potential conversation partner, there exists a permission from the following: <em>Accept by Default</em>, <em>Accept by Individual</em>, <em>Ask by Default</em>, and <em>Ask by Individual</em>. The `by Default' variant always exists as a catch-all.</p>
    <p>Conversant permissions do not appear anywhere in the Chatterbox protocol, however. Assuming that some facility outside the protocol exists for changing the permissions, a conversation's permission data could fall out of sync with the database. That external facility will be provided by a ReSTful interface. At the invitation stage of a conversation, the server will reconcile user permissions to auto-initialize as many clients as possible. If a client chooses to alter any permissions after this stage, though, the client is responsible for initializing any relevant conversations.</p>
  </div>

  <div id="connection-states">
    <h2>Connection States</h2>
        <p>The <em>Initiater</em> proposes a conversation amongst a set of <em>Target Conversants</em> and himself, creating a conversation with connections to each potential conversant, including himself. Each connection has two possible states:</p>
    <dl>
      <dt>Closed</dt><dd>The associated Target Conversant has neither accepted nor rejected the proposed conversation.</dd>
      <dt>Open</dt><dd>The associated Target Conversant has accepted the proposed conversation. The Initiater's never exists in a Closed state.</dd>
    </dl>
    Terminated connections require no third state, as the server immediately purges any conversation rejecters.
  </div>

  <div id="chatterbox-actions">
    <h2>Actions</h2>
    <h3 id="action-invite">Invite Conversants</h3>
    <p>An Initiater sends an invitation to a set of Target Conversants, creating a conversation. The server creates an Open connection between the Initiater and the new conversation. The server is free to choose a set of conversant connections that share mutually applicable <em>Accept by Default</em> or <em>Accept by Individual</em> permissions to construct in the Open state as well. The remaining invited conversants have their connections constructed in the Closed state.</p>

    <h3 id="action-initialize">Initialize Connection</h3>
    <p>The Initiater instigates this action by <a href="#action-invite">inviting</a> the would-be Initializer to a conversation. The server constructs a subset of connections in the Open state, including the Initiater's. The conversants with connections in the Closed state must send an <a href="message-initialize">initialization</a> message to join the conversation, transitioning the corresponding connection state to Open.</p>

    <h3 id="conversation-initialize-with-targets">Handle Conversation Initializations</h3>
    <p>If a Target Conversant has confirmed conversation with the Instigator or if such confirmation is pending, then any connections to the same conversation with Open state and <em>Ask by Default</em> or <em>Ask by Individual</em> <a href="#chatterbox-conversant-permissions">permission</a> require additional confirmation. Connections governed by <em>Accept by Default</em> or <em>Accept by Individual</em> are confirmed entirely on the serverside.</p>

    <h3 id="conversation-eject-conversant">Eject Conversant</h3>
    <p>Any conversant can attempt to eject any other conversant (including the Initiater or himself). If the Ejectee is also the Ejector, then this action is interpreted as a resignation from the conversation. Otherwise, in conversations with <em>N</em> conversants and <em>N > 2</em>, <em>N-1</em> conversants can agree to eject the <em>N</em>th conversant, while any ejection request where <em>N = 2</em> destroys the conversation.</p>
    <p>PURGE USER FROM CONFIRMATION QUEUES on the serverside.</p>

    <h3 id="conversation-message">Conversant Sends a Message</h3>
    <p>Messages are sent to the conversation itself, not individuals. If a conversant wants a subset of conversants to see a message, then he needs to explicitly build a conversation with only those conversants.</p>
  </div>

  <div id="chatterbox-conversation-negotiation">
    <h2>Conversation Negotiation</h2>
    <h3>Server to User Messages</h3>
    <dl>
      <dt>conversation</dt>
      <dd></dd>
      <dt>messages</dt>
      <dd></dd>
    </dl>
    
    <h3>User to Server Messages</h3>
    <dl>
      <dt>invite</dt>
      <dd></dd>
      <dt>speak</dt>
      <dd></dd>
      <dt>initialize</dt>
      <dd></dd>
      <dt>eject</dt>
      <dd></dd>
      <dt>close</dt>
      <dd></dd>
    </dl>

    <div class="hash message-from-1">
      <div class="pair">
        <span class="key">command</span>
        <span class="value">"invite"</span>
      </div>
      <div class="pair">
        <span class="key">targetConversants</span>
        <span class="array value">
          <span class="value">2</span>
          <span class="value">3</span>
          <span class="value">4</span>
        </span>
      </div>
      <div class="pair">
        <span class="key">message</span>
        <span class="value">"Let us talk."</span>
      </div>
    </div>

    <div class="hash message-to-1">
      <div class="pair">
        <span class="key">notice</span>
        <span class="value">"conversation"</span>
      </div>
      <div class="pair">
        <span class="key">conversationId</span>
        <span class="value">18</span>
      </div>
      <div class="pair">
        <span class="key">self</span>
        <div class="hash value">
          <div class="pair">
            <span class="key">userId</span>
            <span class="value">1</span>
          </div>
          <div class="pair">
            <span class="key">userName</span>
            <span class="value">"Memothy"</span>
          </div>
          <div class="pair">
            <span class="key">connectionState</span>
            <span class="value">"open"</span>
          </div>
          <div class="pair">
            <span class="key">ejectionState</span>
            <div class="hash value">
              <div class="pair">
                <span class="key">votes</span>
                <span class="value">0</span>
              </div>
              <div class="pair">
                <span class="key">requiredVotes</span>
                <span class="value">1</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="pair">
        <span class="key">others</span>
        <div class="array value">
          <div class="hash value">
            <div class="pair">
              <span class="key">userId</span>
              <span class="value">2</span>
            </div>
            <div class="pair">
              <span class="key">userName</span>
              <span class="value">"Spiderman"</span>
            </div>
            <div class="pair">
              <span class="key">connectionState</span>
              <span class="value">"open"</span>
            </div>
            <div class="pair">
              <span class="key">ejectionState</span>
              <div class="hash value">
                <div class="pair">
                  <span class="key">votes</span>
                  <span class="value">0</span>
                </div>
                <div class="pair">
                  <span class="key">requiredVotes</span>
                  <span class="value">1</span>
                </div>
              </div>
            </div>
            <div class="pair">
              <span class="key">permission</span>
              <div class="hash value">
                <div class="pair">
                  <span class="key">value</span>
                  <span class="value">"accept"</span>
                </div>
                <div class="pair">
                  <span class="key">scope</span>
                  <span class="value">"default"</span>
                </div>
              </div>
            </div>
          </div>
          <div class="hash value">...</div>
          <div class="hash value">...</div>
        </div>
      </div>
    </div>
    <div class="hash message-to-2">...</div>
    <div class="hash message-to-3">...</div>
    <div class="hash message-to-4">...</div>

    <div class="hash message-from-1">
      <div class="pair">
        <span class="key">command</span>
        <span class="value">"speak"</span>
      </div>
      <div class="pair">
        <span class="key">conversationId</span>
        <span class="value">18</span>
      </div>
      <div class="pair">
        <span class="key">message</span>
        <span class="value">"Hello?"</span>
      </div>
    </div>

    <div class="hash message-to-all">
      <div class="pair">
        <span class="key">notice</span>
        <span class="value">"messages"</span>
      </div>
      <div class="pair">
        <span class="key">conversationId</span>
        <span class="value">18</span>
      </div>
      <div class="pair">
        <span class="key">messages</span>
        <div class="array value">
          <div class="hash value">
            <div class="pair">
              <span class="key">userId</span>
              <span class="value">1</span>
            </div>
            <div class="pair">
              <span class="key">userName</span>
              <span class="value">Memothy</span>
            </div>
            <div class="pair">
              <span class="key">timeStamp</span>
              <span class="value">128474849</span>
            </div>
            <div class="pair">
              <span class="key">message</span>
              <span class="value">"Hello?"</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="hash message-from-3">
      <div class="hash value">
        <div class="pair">
          <span class="key">command</span>
          <span class="value">"initialize"</span>
        </div>
      </div>
    </div>

    <div class="hash message-to-1">
      <div class="pair">
        <span class="key">notice</span>
        <span class="value">"conversation"</span>
      </div>
      <div class="pair">
        <span class="key">conversationId</span>
        <span class="value">18</span>
      </div>
      <div class="pair">
        <span class="key">self</span>
        <div class="hash value">
          <div class="pair">
            <span class="key">userId</span>
            <span class="value">1</span>
          </div>
          <div class="pair">
            <span class="key">userName</span>
            <span class="value">"Memothy"</span>
          </div>
          <div class="pair">
            <span class="key">connectionState</span>
            <span class="value">"open"</span>
          </div>
          <div class="pair">
            <span class="key">ejectionState</span>
            <div class="hash value">
              <div class="pair">
                <span class="key">votes</span>
                <span class="value">0</span>
              </div>
              <div class="pair">
                <span class="key">requiredVotes</span>
                <span class="value">2</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="pair">
        <span class="key">others</span>
        <div class="array value">
          <div class="hash value">...</div>
          <div class="hash value">
            <div class="pair">
              <span class="key">userId</span>
              <span class="value">3</span>
            </div>
            <div class="pair">
              <span class="key">userName</span>
              <span class="value">"Sudoer"</span>
            </div>
            <div class="pair">
              <span class="key">connectionState</span>
              <span class="value">"open"</span>
            </div>
            <div class="pair">
              <span class="key">ejectionState</span>
              <div class="hash value">
                <div class="pair">
                  <span class="key">votes</span>
                  <span class="value">0</span>
                </div>
                <div class="pair">
                  <span class="key">requiredVotes</span>
                  <span class="value">2</span>
                </div>
              </div>
            </div>
            <div class="pair">
              <span class="key">permission</span>
              <div class="hash value">
                <div class="pair">
                  <span class="key">value</span>
                  <span class="value">"accept"</span>
                </div>
                <div class="pair">
                  <span class="key">scope</span>
                  <span class="value">"individual"</span>
                </div>
              </div>
            </div>
          </div>
          <div class="hash value">...</div>
        </div>
      </div>
    </div>
    <div class="hash message-to-2">...</div>
    <div class="hash message-to-3">...</div>
    <div class="hash message-to-4">...</div>

    <div class="hash message-from-3">
      <div class="pair">
        <span class="key">command</span>
        <span class="value">"speak"</span>
      </div>
      <div class="pair">
        <span class="key">conversationId</span>
        <span class="value">18</span>
      </div>
      <div class="pair">
        <span class="key">message</span>
        <span class="value">"sudo make me a sandwich."</span>
      </div>
    </div>

    <div class="hash message-from-2">
      <div class="pair">
        <span class="key">command</span>
        <span class="value">"speak"</span>
      </div>
      <div class="pair">
        <span class="key">conversationId</span>
        <span class="value">18</span>
      </div>
      <div class="pair">
        <span class="key">message</span>
        <span class="value">"sudo Sudoer isn't welcome here."</span>
      </div>
    </div>

    <div class="hash message-to-all">
      <div class="pair">
        <span class="key">notice</span>
        <span class="value">"messages"</span>
      </div>
      <div class="pair">
        <span class="key">conversationId</span>
        <span class="value">18</span>
      </div>
      <div class="pair">
        <span class="key">messages</span>
        <div class="array value">
          <div class="hash value">
            <div class="pair">
              <span class="key">userId</span>
              <span class="value">3</span>
            </div>
            <div class="pair">
              <span class="key">userName</span>
              <span class="value">Sudoer</span>
            </div>
            <div class="pair">
              <span class="key">timeStamp</span>
              <span class="value">12847593</span>
            </div>
            <div class="pair">
              <span class="key">message</span>
              <span class="value">"sudo make me a sandwich."</span>
            </div>
          </div>
          <div class="hash value">
            <div class="pair">
              <span class="key">userId</span>
              <span class="value">2</span>
            </div>
            <div class="pair">
              <span class="key">userName</span>
              <span class="value">Spiderman</span>
            </div>
            <div class="pair">
              <span class="key">timeStamp</span>
              <span class="value">12847998</span>
            </div>
            <div class="pair">
              <span class="key">message</span>
              <span class="value">"sudo Sudoer isn't welcome here."</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="hash message-from-2">
      <div class="pair">
        <span class="key">command</span>
        <span class="value">"eject"</span>
      </div>
      <div class="pair">
        <span class="key">conversationId</span>
        <span class="value">18</span>
      </div>
      <div class="pair">
        <span class="key">ejecteeId</span>
        <span class="value">3</span>
      </div>
    </div>

    <div class="hash message-to-1">
      <div class="pair">
        <span class="key">notice</span>
        <span class="value">"conversation"</span>
      </div>
      <div class="pair">
        <span class="key">conversationId</span>
        <span class="value">18</span>
      </div>
      <div class="pair">
        <span class="key">self</span>
        <div class="hash value">
          <div class="pair">
            <span class="key">userId</span>
            <span class="value">1</span>
          </div>
          <div class="pair">
            <span class="key">userName</span>
            <span class="value">"Memothy"</span>
          </div>
          <div class="pair">
            <span class="key">connectionState</span>
            <span class="value">"open"</span>
          </div>
          <div class="pair">
            <span class="key">ejectionState</span>
            <div class="hash value">
              <div class="pair">
                <span class="key">votes</span>
                <span class="value">0</span>
              </div>
              <div class="pair">
                <span class="key">requiredVotes</span>
                <span class="value">2</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="pair">
        <span class="key">others</span>
        <div class="array value">
          <div class="hash value">...</div>
          <div class="hash value">
            <div class="pair">
              <span class="key">userId</span>
              <span class="value">3</span>
            </div>
            <div class="pair">
              <span class="key">userName</span>
              <span class="value">"Sudoer"</span>
            </div>
            <div class="pair">
              <span class="key">connectionState</span>
              <span class="value">"open"</span>
            </div>
            <div class="pair">
              <span class="key">ejectionState</span>
              <div class="hash value">
                <div class="pair">
                  <span class="key">votes</span>
                  <span class="value">1</span>
                </div>
                <div class="pair">
                  <span class="key">requiredVotes</span>
                  <span class="value">2</span>
                </div>
              </div>
            </div>
            <div class="pair">
              <span class="key">permission</span>
              <div class="hash value">
                <div class="pair">
                  <span class="key">value</span>
                  <span class="value">"accept"</span>
                </div>
                <div class="pair">
                  <span class="key">scope</span>
                  <span class="value">"individual"</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="hash message-to-2">...</div>
    <div class="hash message-to-3">...</div>
    <div class="hash message-to-4">...</div>

    <div class="hash message-from-4">
      <div class="pair">
        <span class="key">command</span>
        <span class="value">"initialize"</span>
      </div>
    </div>

    <div class="hash message-to-1">
      <div class="pair">
        <span class="key">notice</span>
        <span class="value">"conversation"</span>
      </div>
      <div class="pair">
        <span class="key">conversationId</span>
        <span class="value">18</span>
      </div>
      <div class="pair">
        <span class="key">self</span>
        <div class="hash value">
          <div class="pair">
            <span class="key">userId</span>
            <span class="value">1</span>
          </div>
          <div class="pair">
            <span class="key">userName</span>
            <span class="value">"Memothy"</span>
          </div>
          <div class="pair">
            <span class="key">connectionState</span>
            <span class="value">"open"</span>
          </div>
          <div class="pair">
            <span class="key">ejectionState</span>
            <div class="hash value">
              <div class="pair">
                <span class="key">votes</span>
                <span class="value">0</span>
              </div>
              <div class="pair">
                <span class="key">requiredVotes</span>
                <span class="value">3</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="pair">
        <span class="key">others</span>
        <div class="array value">
          <div class="hash value">...</div>
          <div class="hash value">...</div>
          <div class="hash value">
            <div class="pair">
              <span class="key">userId</span>
              <span class="value">4</span>
            </div>
            <div class="pair">
              <span class="key">userName</span>
              <span class="value">"Schemer"</span>
            </div>
            <div class="pair">
              <span class="key">connectionState</span>
              <span class="value">"open"</span>
            </div>
            <div class="pair">
              <span class="key">ejectionState</span>
              <div class="hash value">
                <div class="pair">
                  <span class="key">votes</span>
                  <span class="value">0</span>
                </div>
                <div class="pair">
                  <span class="key">requiredVotes</span>
                  <span class="value">3</span>
                </div>
              </div>
            </div>
            <div class="pair">
              <span class="key">permission</span>
              <div class="hash value">
                <div class="pair">
                  <span class="key">value</span>
                  <span class="value">"accept"</span>
                </div>
                <div class="pair">
                  <span class="key">scope</span>
                  <span class="value">"individual"</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="hash message-to-2">...</div>
    <div class="hash message-to-3">...</div>
    <div class="hash message-to-4">...</div>

    <div class="hash message-from-1">
      <div class="pair">
        <span class="key">command</span>
        <span class="value">"eject"</span>
      </div>
      <div class="pair">
        <span class="key">conversationId</span>
        <span class="value">18</span>
      </div>
      <div class="pair">
        <span class="key">ejecteeId</span>
        <span class="value">3</span>
      </div>
    </div>

    <div class="hash message-to-1">
      <div class="pair">
        <span class="key">notice</span>
        <span class="value">"conversation"</span>
      </div>
      <div class="pair">
        <span class="key">conversationId</span>
        <span class="value">18</span>
      </div>
      <div class="pair">
        <span class="key">self</span>
        <div class="hash value">
          <div class="pair">
            <span class="key">userId</span>
            <span class="value">1</span>
          </div>
          <div class="pair">
            <span class="key">userName</span>
            <span class="value">"Memothy"</span>
          </div>
          <div class="pair">
            <span class="key">connectionState</span>
            <span class="value">"open"</span>
          </div>
          <div class="pair">
            <span class="key">ejectionState</span>
            <div class="hash value">
              <div class="pair">
                <span class="key">votes</span>
                <span class="value">0</span>
              </div>
              <div class="pair">
                <span class="key">requiredVotes</span>
                <span class="value">3</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="pair">
        <span class="key">others</span>
        <div class="array value">
          <div class="hash value">...</div>
          <div class="hash value">
            <div class="pair">
              <span class="key">userId</span>
              <span class="value">3</span>
            </div>
            <div class="pair">
              <span class="key">userName</span>
              <span class="value">"Sudoer"</span>
            </div>
            <div class="pair">
              <span class="key">connectionState</span>
              <span class="value">"open"</span>
            </div>
            <div class="pair">
              <span class="key">ejectionState</span>
              <div class="hash value">
                <div class="pair">
                  <span class="key">votes</span>
                  <span class="value">2</span>
                </div>
                <div class="pair">
                  <span class="key">requiredVotes</span>
                  <span class="value">3</span>
                </div>
              </div>
            </div>
            <div class="pair">
              <span class="key">permission</span>
              <div class="hash value">
                <div class="pair">
                  <span class="key">value</span>
                  <span class="value">"accept"</span>
                </div>
                <div class="pair">
                  <span class="key">scope</span>
                  <span class="value">"individual"</span>
                </div>
              </div>
            </div>
          </div>
          <div class="hash value">...</div>
        </div>
      </div>
    </div>
    <div class="hash message-to-2">...</div>
    <div class="hash message-to-3">...</div>
    <div class="hash message-to-4">...</div>

    <div class="hash message-from-3">
      <div class="pair">
        <span class="key">command</span>
        <span class="value">"speak"</span>
      </div>
      <div class="pair">
        <span class="key">conversationId</span>
        <span class="value">18</span>
      </div>
      <div class="pair">
        <span class="key">message</span>
        <span class="value">"I'm still here. Mwah hahaha."</span>
      </div>
    </div>

    <div class="hash message-to-all">
      <div class="pair">
        <span class="key">notice</span>
        <span class="value">"messages"</span>
      </div>
      <div class="pair">
        <span class="key">conversationId</span>
        <span class="value">18</span>
      </div>
      <div class="pair">
        <span class="key">messages</span>
        <div class="array value">
          <div class="hash value">
            <div class="pair">
              <span class="key">userId</span>
              <span class="value">3</span>
            </div>
            <div class="pair">
              <span class="key">userName</span>
              <span class="value">Sudoer</span>
            </div>
            <div class="pair">
              <span class="key">timeStamp</span>
              <span class="value">12847693</span>
            </div>
            <div class="pair">
              <span class="key">message</span>
              <span class="value">"I'm still here. Mwah hahaha."</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="hash message-from-3">
      <div class="pair">
        <span class="key">command</span>
        <span class="value">"eject"</span>
      </div>
      <div class="pair">
        <span class="key">conversationId</span>
        <span class="value">18</span>
      </div>
      <div class="pair">
        <span class="key">ejecteeId</span>
        <span class="value">1</span>
      </div>
    </div>

    <div class="hash message-to-1">
      <div class="pair">
        <span class="key">notice</span>
        <span class="value">"conversation"</span>
      </div>
      <div class="pair">
        <span class="key">conversationId</span>
        <span class="value">18</span>
      </div>
      <div class="pair">
        <span class="key">self</span>
        <div class="hash value">
          <div class="pair">
            <span class="key">userId</span>
            <span class="value">1</span>
          </div>
          <div class="pair">
            <span class="key">userName</span>
            <span class="value">"Memothy"</span>
          </div>
          <div class="pair">
            <span class="key">connectionState</span>
            <span class="value">"open"</span>
          </div>
          <div class="pair">
            <span class="key">ejectionState</span>
            <div class="hash value">
              <div class="pair">
                <span class="key">votes</span>
                <span class="value">1</span>
              </div>
              <div class="pair">
                <span class="key">requiredVotes</span>
                <span class="value">3</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="pair">
        <span class="key">others</span>
        <div class="array value">
          <div class="hash value">...</div>
          <div class="hash value">...</div>
          <div class="hash value">...</div>
        </div>
      </div>
    </div>
    <div class="hash message-to-2">...</div>
    <div class="hash message-to-3">...</div>
    <div class="hash message-to-4">...</div>

    <div class="hash message-from-4">
      <div class="pair">
        <span class="key">command</span>
        <span class="value">"eject"</span>
      </div>
      <div class="pair">
        <span class="key">conversationId</span>
        <span class="value">18</span>
      </div>
      <div class="pair">
        <span class="key">ejecteeId</span>
        <span class="value">3</span>
      </div>
    </div>

    <div class="hash message-to-1">
      <div class="pair">
        <span class="key">notice</span>
        <span class="value">"conversation"</span>
      </div>
      <div class="pair">
        <span class="key">conversationId</span>
        <span class="value">18</span>
      </div>
      <div class="pair">
        <span class="key">self</span>
        <div class="hash value">
          <div class="pair">
            <span class="key">userId</span>
            <span class="value">1</span>
          </div>
          <div class="pair">
            <span class="key">userName</span>
            <span class="value">"Memothy"</span>
          </div>
          <div class="pair">
            <span class="key">connectionState</span>
            <span class="value">"open"</span>
          </div>
          <div class="pair">
            <span class="key">ejectionState</span>
            <div class="hash value">
              <div class="pair">
                <span class="key">votes</span>
                <span class="value">0</span>
              </div>
              <div class="pair">
                <span class="key">requiredVotes</span>
                <span class="value">2</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="pair">
        <span class="key">others</span>
        <div class="array value">
          <div class="hash value">...</div>
          <div class="hash value">...</div>
        </div>
      </div>
    </div>
    <div class="hash message-to-2">...</div>
    <div class="hash message-to-4">...</div>

    <div class="hash message-from-1">
      <div class="pair">
        <span class="key">command</span>
        <span class="value">"close"</span>
      </div>
      <div class="pair">
        <span class="key">conversationId</span>
        <span class="value">18</span>
      </div>
    </div>

    <div class="hash message-to-2">
      <div class="pair">
        <span class="key">notice</span>
        <span class="value">"conversation"</span>
      </div>
      <div class="pair">
        <span class="key">conversationId</span>
        <span class="value">18</span>
      </div>
      <div class="pair">
        <span class="key">self</span>
        <div class="hash value">
          <div class="pair">
            <span class="key">userId</span>
            <span class="value">2</span>
          </div>
          <div class="pair">
            <span class="key">userName</span>
            <span class="value">"Spiderman"</span>
          </div>
          <div class="pair">
            <span class="key">connectionState</span>
            <span class="value">"open"</span>
          </div>
          <div class="pair">
            <span class="key">ejectionState</span>
            <div class="hash value">
              <div class="pair">
                <span class="key">votes</span>
                <span class="value">0</span>
              </div>
              <div class="pair">
                <span class="key">requiredVotes</span>
                <span class="value">1</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="pair">
        <span class="key">others</span>
        <div class="array value">
          <div class="hash value">
            <div class="pair">
              <span class="key">userId</span>
              <span class="value">4</span>
            </div>
            <div class="pair">
              <span class="key">userName</span>
              <span class="value">"Schemer"</span>
            </div>
            <div class="pair">
              <span class="key">connectionState</span>
              <span class="value">"open"</span>
            </div>
            <div class="pair">
              <span class="key">ejectionState</span>
              <div class="hash value">
                <div class="pair">
                  <span class="key">votes</span>
                  <span class="value">0</span>
                </div>
                <div class="pair">
                  <span class="key">requiredVotes</span>
                  <span class="value">1</span>
                </div>
              </div>
            </div>
            <div class="pair">
              <span class="key">permission</span>
              <div class="hash value">
                <div class="pair">
                  <span class="key">value</span>
                  <span class="value">"ask"</span>
                </div>
                <div class="pair">
                  <span class="key">scope</span>
                  <span class="value">"individual"</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="hash message-to-4">...</div>

    <div class="hash message-from-2">
      <div class="pair">
        <span class="key">command</span>
        <span class="value">"speak"</span>
      </div>
      <div class="pair">
        <span class="key">conversationId</span>
        <span class="value">18</span>
      </div>
      <div class="pair">
        <span class="key">message</span>
        <span class="value">"Looks like its just the two of us, then?"</span>
      </div>
    </div>

    <div class="hash message-to-2">
      <div class="pair">
        <span class="key">notice</span>
        <span class="value">"conversation"</span>
      </div>
      <div class="pair">
        <span class="key">conversationId</span>
        <span class="value">18</span>
      </div>
      <div class="pair">
        <span class="key">messages</span>
        <div class="array value">
          <div class="hash value">
            <div class="pair">
              <span class="key">userId</span>
              <span class="value">2</span>
            </div>
            <div class="pair">
              <span class="key">userName</span>
              <span class="value">Spiderman</span>
            </div>
            <div class="pair">
              <span class="key">timeStamp</span>
              <span class="value">12863425</span>
            </div>
            <div class="pair">
              <span class="key">message</span>
              <span class="value">"Looks like its just the two of us, then?"</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="hash message-from-4">
      <div class="pair">
        <span class="key">command</span>
        <span class="value">"speak"</span>
      </div>
      <div class="pair">
        <span class="key">conversationId</span>
        <span class="value">18</span>
      </div>
      <div class="pair">
        <span class="key">message</span>
        <span class="value">"Speak for yourself, Spidey."</span>
      </div>
    </div>

    <div class="hash message-to-2">
      <div class="pair">
        <span class="key">notice</span>
        <span class="value">"messages"</span>
      </div>
      <div class="pair">
        <span class="key">conversationId</span>
        <span class="value">18</span>
      </div>
      <div class="pair">
        <span class="key">messages</span>
        <div class="array value">
          <div class="hash value">
            <div class="pair">
              <span class="key">userId</span>
              <span class="value">4</span>
            </div>
            <div class="pair">
              <span class="key">userName</span>
              <span class="value">Schemer</span>
            </div>
            <div class="pair">
              <span class="key">timeStamp</span>
              <span class="value">12857235</span>
            </div>
            <div class="pair">
              <span class="key">message</span>
              <span class="value">"Speak for yourself, Spidey."</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="hash message-to-4">...</div>

    <div class="hash message-from-4">
      <div class="pair">
        <span class="key">command</span>
        <span class="value">"close"</span>
      </div>
      <div class="pair">
        <span class="key">conversationId</span>
        <span class="value">18</span>
      </div>
    </div>
  </div>

<!--
  <div id="chatterbox-prototype">
    <h1>Prototype</h1>
    <p>First attempt at a chat prototype.</p>
    <script type="text/javascript">
    YUI().use('chatterbox', function(Y) {
        var chatterbox = new Y.ChatterBox({
                owner : {
                    userId : '2',
                    username : 'tpopham'
                },
                conversationsUrl : '/conversation/1282993/available'
            });
        
        chatterbox.render('#chatterbox-prototype');
    });
    </script>
  </div>

  <div id="chatterbox-static">
    <h1>Web Application Widget</h1>
    <div class="chatterbox-widget">
      <ol>
        <li class="chatterbox-partner chatterbox-recent-partner">
          <div class="chatterbox-avatar chatterbox-avatar-1"><img src="img/unanswered/3.png" alt="3 unanswered messages" /></div>
          <div class="chatterbox-partner-info">
            <span class="chatterbox-username">tpopham</span>&nbsp;-<br />
            <span class="chatterbox-last-touch">13&nbsp;min</span>
          </div>
        </li>
        <li class="chatterbox-partner chatterbox-recent-partner">
          <div class="chatterbox-avatar chatterbox-avatar-1"><img src="img/unanswered/0.png" alt="0 unanswered messages" /></div>
          <div class="chatterbox-partner-info">
            <span class="chatterbox-username">memothy</span>&nbsp;-<br />
            <span class="chatterbox-last-touch">18&nbsp;min</span>
          </div>
        </li>
        <li class="chatterbox-selected chatterbox-partner chatterbox-recent-partner">
          <div class="chatterbox-avatar chatterbox-avatar-1"><img src="img/unanswered/1.png" alt="1 unanswered messages" /></div>
          <div class="chatterbox-partner-info">
            <span class="chatterbox-username">batman</span>&nbsp;-<br />
            <span class="chatterbox-last-touch">18&nbsp;min</span>
          </div>
        </li>
        <li class="chatterbox-partner chatterbox-recent-partner">
          <div class="chatterbox-avatar chatterbox-avatar-1"><img src="img/unanswered/1.png" alt="1 unanswered messages" /></div>
          <div class="chatterbox-partner-info">
            <span class="chatterbox-username">greenlantern</span>&nbsp;-<br />
            <span class="chatterbox-last-touch">19&nbsp;min</span>
          </div>
        </li>
        <li class="chatterbox-partner chatterbox-recent-partner">
          <div class="chatterbox-avatar chatterbox-avatar-1"><img src="img/unanswered/5.png" alt="5 unanswered messages" /></div>
          <div class="chatterbox-partner-info">
            <span class="chatterbox-username">schemer</span>&nbsp;-<br />
            <span class="chatterbox-last-touch">28&nbsp;min</span>
          </div>
          <div class="chatterbox-messages">
            <div class="chatterbox-from-non-me">
              <span class="chatterbox-handle">schemer</span>: Hello.
            </div>
            <div class="chatterbox-from-me">
              <span class="chatterbox-handle">Me</span>: Mahalo.
            </div>
            <div class="chatterbox-from-non-me">
              <span class="chatterbox-handle">schemer</span>: Echo.
            </div>
            <div class="chatterbox-from-non-me">
              <span class="chatterbox-handle">schemer</span>: echo.
            </div>
            <div class="chatterbox-from-non-me">
              <span class="chatterbox-handle">schemer</span>: ceho.
            </div>
            <div class="chatterbox-from-non-me">
              <span class="chatterbox-handle">schemer</span>: hceo.
            </div>
            <div class="chatterbox-from-non-me">
              <span class="chatterbox-handle">schemer</span>: oche.
            </div>
          </div>
        </li>
        <li class="chatterbox-partner chatterbox-recent-partner">
          <div class="chatterbox-avatar chatterbox-avatar-1"><img src="img/unanswered/4.png" alt="4 unanswered messages" /></div>
          <div class="chatterbox-partner-info">
            <span class="chatterbox-username">littleschemer</span>&nbsp;-<br />
            <span class="chatterbox-last-touch">29&nbsp;min</span>
          </div>
        </li>
        <li class="chatterbox-partner chatterbox-available-partner">
          <div class="chatterbox-avatar chatterbox-avatar-1" />
          <div class="chatterbox-partner-info">
            <span class="chatterbox-username">george</span>
          </div>
        </li>
        <li class="chatterbox-partner chatterbox-available-partner">
          <div class="chatterbox-avatar chatterbox-avatar-1" />
          <div class="chatterbox-partner-info">
            <span class="chatterbox-username">mary</span>
          </div>
        </li>
        <li class="chatterbox-partner chatterbox-available-partner">
          <div class="chatterbox-avatar chatterbox-avatar-1" />
          <div class="chatterbox-partner-info">
            <span class="chatterbox-username">peter</span>
          </div>
        </li>
        <li class="chatterbox-partner chatterbox-available-partner">
          <div class="chatterbox-avatar chatterbox-avatar-1" />
          <div class="chatterbox-partner-info">
            <span class="chatterbox-username">joser</span>
          </div>
        </li>
        <li class="chatterbox-partner chatterbox-available-partner">
          <div class="chatterbox-avatar chatterbox-avatar-1" />
          <div class="chatterbox-partner-info">
            <span class="chatterbox-username">qwerty</span>
          </div>
        </li>
      </ol>
    </div>
  </div>
-->
  </body>
</html>
